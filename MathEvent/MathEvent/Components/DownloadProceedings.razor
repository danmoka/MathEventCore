@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components
@using System.Net.Http
@using Newtonsoft.Json
@using MathEvent.Helpers

@inject NavigationManager NavigationManager
@inject ClientService ClientService

<input type="button" class="btn btn-block download-btn" @onclick="Download" value="Скачать материалы события" hidden="@(!_isActive)" />

@code {
    [Parameter] public int PerformanceId { get; set; }
    private bool _isActive = false;
    private HttpClient _client;

    protected override async Task OnInitializedAsync()
    {
        _client = ClientService.Client;

        var response = await _client.GetAsync($"/api/Proceedings/isFileExists?performanceId={PerformanceId}");
        var result = await response.Content.ReadAsStringAsync();
        _isActive = JsonConvert.DeserializeObject<bool>(result);
    }

    protected void Download()
    {
        NavigationManager.NavigateTo($"{_client.BaseAddress}/api/Proceedings/downloadProceedings?performanceId={PerformanceId}", true);
    }
}
