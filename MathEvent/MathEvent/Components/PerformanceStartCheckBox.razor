@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.JSInterop
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components
@using MathEvent.Models.ViewModels
@using MathEvent.Helpers
@using System.Net.Http
@using System.ComponentModel
@using Newtonsoft.Json
@using System.Text
@using Microsoft.AspNetCore.Identity
@using MathEvent.Models

@inject ApplicationContext ApplicationContext


<input type="datetime" class="form-control" @bind-value="@Performance.Start"/>
<div class="form-check">
    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" @onchange="@SetSectionTime">
    <label class="form-check-label" for="defaultCheck1">
        Default checkbox
    </label>
</div>

@code {
    [Parameter] public PerformanceViewModel Performance { get; set; }
    private DateTime OldTime { get; set; }

    protected override void OnInitialized()
    {
        if (Performance.Start == null)
        {
            OldTime = DateTime.Now;
        }
        else
        {
            OldTime = Performance.Start;
        }
    }

    protected void SetSectionTime(ChangeEventArgs e)
    {
        if ((bool)e.Value)
        {
            var section = ApplicationContext.Sections.Where(s => s.Id == Performance.SectionId).SingleOrDefault();
            Performance.Start = section.Start;

        }
        else
        {
            Performance.Start = OldTime;
        }

    }
}
