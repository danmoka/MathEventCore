
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.JSInterop
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components
@using MathEvent.Models.ViewModels
@using System.Net.Http
@using System.ComponentModel
@using Newtonsoft.Json
@using System.Text
@*@inject HttpClient Http*@
@inject NavigationManager NavigationManager
<h5>@Count()</h5>
<a @onclick="SignUp">@current</a>

@code {
    [Parameter] public CardViewModel card { get; set; }
    [Parameter] public int traffic { get; set; }

    string current = "";
    //int count = 0;

    protected async Task SignUp()
    {
        var model = JsonConvert.SerializeObject(card);
        var content = new StringContent(model, Encoding.UTF8, "application/json");
        var client = new HttpClient();
        client.BaseAddress = new Uri("https://localhost:44305/");

        if (!card.IsSignedUp)
        {
            current = "Отписаться";
            traffic++;
            card.IsSignedUp = !card.IsSignedUp;
        }
        else
        {
            traffic--;
            current = "Записаться";
            card.IsSignedUp = !card.IsSignedUp;
        }

        var response = await client.PostAsync("api/Subscribe/signup", content);
        //var c = await client.GetAsync($"https://localhost:44305/api/Subscribe?id={id}&userId={userId}");
        //NavigationManager.NavigateTo("https://localhost:44305/Home/Index", true);

        Count();
    }

    protected int Count()
    {
        if (card.IsSignedUp)
        {
            current = "Отписаться";
        }
        else
        {
            current = "Записаться";
        }

        return traffic;
    }
}